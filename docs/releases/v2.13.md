# Release Notes - All-in-Oneãƒ¢ãƒ¼ãƒ‰ãŒã•ã‚‰ã«ä½¿ã„ã‚„ã™ãï¼

## Version: v2.13.5
**Release Date:** 2025-11-20
**Base:** v2.13.4
**Highlights:** All-in-Oneãƒ¢ãƒ¼ãƒ‰ã®æ“ä½œæ€§ã‚’è¦‹ç›´ã—ã¾ã—ãŸã€‚

---

## ğŸ¨ All-in-Oneãƒ¢ãƒ¼ãƒ‰ãŒã•ã‚‰ã«ä½¿ã„ã‚„ã™ãï¼

- **ã‚ˆã‚Šç›´æ„Ÿçš„ãªãƒ‘ãƒãƒ«æ“ä½œ**: ã“ã‚Œã¾ã§ã®ã‚¢ã‚¤ã‚³ãƒ³ã«ä»£ã‚ã‚Šã€ã€Œï¼‹ã€ã€Œï¼ã€ãƒœã‚¿ãƒ³ã§ãƒãƒ£ãƒƒãƒˆç”»é¢ã®æ•°ã‚’ç°¡å˜ã«å¤‰æ›´ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
- **è¨­å®šãŒæ¶ˆãˆãªã„å®‰å¿ƒæ„Ÿ**: ãƒ‘ãƒãƒ«ã®æ•°ã‚’å¤‰ãˆã¦ã‚‚ã€è¨­å®šã—ãŸAIãƒ¢ãƒ‡ãƒ«ã®çµ„ã¿åˆã‚ã›ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œãªããªã‚Šã¾ã—ãŸã€‚ã‚‚ã†ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã³ã«AIã‚’é¸ã³ç›´ã™å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

---

## ğŸš€ Replicate Seamless Support

### 1. Unified Replicate Integration via Image Agent

Replicate support is now integrated as a first-class image provider in the existing Image Agent architecture, enabling consistent behavior across providers.

**Key Points:**
- Uses the standardized asynchronous prediction flow:
  - `POST /v1/models/{model}/predictions`
  - `GET /v1/predictions/{id}` for result polling
- No legacy or incorrect `/generate` endpoint usage.
- Consistent error handling and timeouts aligned with other providers.

**What this means for users:**
- You can configure Replicate as an image provider once and use it seamlessly from Image Agent bots.
- Prediction handling, polling, and status checks are abstracted away for a smoother experience.


### 2. Consistent Provider Handling

- Replicate is treated consistently with other providers in the Image Agent pipeline.
- Tool definitions and endpoint patterns are unified to avoid provider-specific UI confusion.
- Unnecessary Replicate-only configuration UIs and hooks are removed to reduce complexity and prevent misconfiguration.

For the in-app Release Notes UI:
- A visual highlight for this release references `Replicate Support.gif` to showcase the seamless Replicate workflow.
  (Used in the in-app release notes via `releasenote_v2134_replicate_seamless_support`.)
---

## ğŸ–¼ï¸ File Preview Experience Fix

This release also includes improvements from the `file-preview-fix` work:

- Adjusted `ExpandableDialog` behavior for more stable and predictable file/content preview.
- Ensures previews render correctly inside scrollable/expandable areas while maintaining existing layout patterns.
- Keeps consistency with the rest of the UI component system without introducing regressions.

---

## âš™ï¸ Technical Notes

- Bumped extension version to `2.13.4` in the manifest configuration.
- Kept compatibility with the v2.13 Image Agent & provider system.
- No breaking changes to existing configurations; Replicate support is an enhancement on top of the current architecture.

---

## ğŸ“¦ Summary

v2.13.4 delivers:
- Seamless Replicate integration as an Image Agent provider with correct prediction-based APIs.
- Curated Replicate model presets for faster setup.
- Improved file preview behavior aligned with existing UI patterns.

This release focuses on stability and provider completeness to make multi-provider image generation smoother for end users.

# Release Notes - Image Agent & Provider Enhancements

## Version: v2.13 (Image Agent Release)
**Release Date:** 2025-10-29
**Base:** v2.12-provider-support
**Changes:** 33 files changed, 6,410 insertions(+), 2,588 deletions(-)

---

## ğŸ¨ Major New Features

### 1. **Image Agent - Agentic Image Generation System**

A completely new chatbot type that combines LLM reasoning with image generation APIs.

**Architecture:**
- **Prompt Generator Bot**: Any Claude or OpenAI-compatible chatbot that analyzes user requests and generates optimal image prompts
- **Image Provider**: Dedicated image generation API (Chutes AI, Novita AI, Replicate)
- **Tool Calling**: LLM uses `generate_image` tool to trigger actual image generation

**Features:**
- ğŸ¤– Agentic prompt enhancement (LLM improves your prompts)
- ğŸ¨ Support for multiple image generation providers
- ğŸ–¼ï¸ Image editing support (provider-dependent)
- ğŸ“Š Real-time generation parameter display
- ğŸ”„ Conversation history support

**Supported Image Providers:**
- **Chutes AI**: Fast, cost-effective (Chroma, FLUX.1-dev models)
- **Novita AI**: Multiple models (Qwen Image, Hunyuan Image 3, Seedream 4.0)
- **Replicate**: Premium quality (Google Imagen 4)

**New Files:**
- `src/app/bots/image-agent/index.ts` (293 lines) - Core Image Agent implementation
- `src/services/image-api-client.ts` (353 lines) - Unified API client for multiple providers
- `src/services/image-tool-definitions.ts` (401 lines) - Model-specific tool definitions and configurations

---

## ğŸ”§ Provider System Enhancements

### 2. **API Provider Management**

**New Provider Configuration UI:**
- Centralized provider management (API Providers tab)
- Visual provider cards with icons
- Provider reference system (multiple chatbots can share one provider)
- Automatic provider detection and configuration

**New Providers Added:**
- `ChutesAI` - Image generation
- `NovitaAI` - Multi-model image generation
- `Replicate` - Premium image generation (Google Imagen 4)

**Provider Features:**
- Output type selection (Text / Image)
- Full Path vs Base URL mode
- Model-specific endpoint construction
- Dynamic placeholder support (`%model`)

### 3. **User Config Modularization**

Restructured configuration system for better maintainability:

**New Modular Structure:**
```
src/services/user-config/types/
â”œâ”€â”€ base.ts           - Core types, enums, constants
â”œâ”€â”€ provider.ts       - Provider-specific types
â”œâ”€â”€ chatbot.ts        - Chatbot configuration types
â”œâ”€â”€ image-settings.ts - Image generation settings
â””â”€â”€ index.ts          - Re-exports
```

**New Constants:**
- `CLAUDE_COMPATIBLE_PROVIDERS` - Claude API providers
- `THINKING_BUDGET_PROVIDERS` - Extended thinking support
- `IMAGE_ONLY_PROVIDERS` - Image-only providers
- `OPENAI_COMPATIBLE_PROVIDERS` - OpenAI-compatible providers

**Benefits:**
- 154 lines removed from `user-config.ts` (better organization)
- Type safety improvements
- Easier to maintain and extend

---

## ğŸ¯ UI/UX Improvements

### 4. **Settings Interface Enhancements**

**ChatbotSettings.tsx Improvements:**
- Separated Image Agent settings from Image Function Tool settings
- Auto-save default models for Novita and Replicate
- Improved conditional flag organization
- Clearer provider mode detection
- Tool Definition preview with %model placeholder resolution

**ProviderEditModal.tsx:**
- Output Type tabs (Text / Image)
- Provider-specific help text for API Host
- Auto-fill default hosts when switching schemes
- Full Path mode enforcement for specific providers (Replicate, VertexAI Claude)
- Visual provider capability indicators

**ApiProviderSettings.tsx:**
- Grid-based provider card layout
- Inline provider editing
- Provider reordering (move up/down)
- Provider duplication
- Automatic chatbot cleanup when provider deleted

### 5. **Icon Component System**

**New Component:**
- `src/app/components/icons/CopyIcon.tsx` - Reusable icon component

**Changes:**
- Replaced inline SVG with component-based icons
- Unified icon styling approach
- Better maintainability

---

## ğŸ”„ API & Integration Changes

### 6. **Image API Client Architecture**

**Three API Patterns Supported:**

1. **Synchronous (Chutes AI)**
   - Direct image binary response
   - Immediate result

2. **Asynchronous with Polling (Novita AI)**
   - POST â†’ `{task_id}`
   - Poll GET `/task-result?task_id=...`
   - Status: `TASK_STATUS_SUCCEED` / `TASK_STATUS_FAILED`

3. **Asynchronous with Prediction (Replicate)**
   - POST `/v1/models/{model}/predictions` â†’ `{id}`
   - Poll GET `/v1/predictions/{id}`
   - Status: `succeeded` / `failed` / `canceled`

**Features:**
- Automatic provider pattern detection
- 3-minute timeout with 2-second polling interval
- Error handling with detailed messages
- Support for both data URLs and CDN URLs

### 7. **Tool Definition System**

**Model-Specific Configurations:**
- Each model has dedicated tool definition (Claude Tool Use format)
- Automatic conversion to OpenAI Function Calling format
- Model registry with aliases for flexible matching
- Default model auto-detection from model name

**Supported Models:**
- Chutes: Chroma, FLUX.1-dev
- Novita: Qwen Image, Hunyuan Image 3, Seedream 4.0
- Replicate: Google Imagen 4

---

## ğŸ› ï¸ Technical Improvements

### 8. **Code Quality & Refactoring**

**Removed:**
- `image-tools.ts` (234 lines, unused)
- Unused imports (4 items from ChatbotSettings.tsx)
- Redundant fallback logic
- Duplicate provider type checks

**Improved:**
- Simplified `providerIsImageMode()` function
- Removed unnecessary default fallbacks that masked configuration errors
- Centralized thinking budget provider list
- Clarified geminiAuthMode logic with intermediate variables

**Error Handling:**
- Image model must be explicitly configured (no silent defaults)
- Clear error messages for missing configuration
- Proper error propagation in Image Agent

### 9. **Storage Migration**

**Chat Pair Storage:**
- Migrated from sync storage to local storage
- Better performance for frequently changing data
- Avoids sync storage quota issues

### 10. **Developer Experience**

**New Scripts:**
- `scripts/zip.mjs` - Automated extension packaging
- `yarn package` command for distribution

**Documentation:**
- Model-specific API documentation (Replicate Imagen 4, Novita models)
- Architecture notes for Image Agent
- Tool definition examples

---

## ğŸ› Bug Fixes

1. **Replicate Endpoint**: Fixed incorrect `/generate` endpoint â†’ correct `/v1/models/%model/predictions`
2. **Tool Definition Display**: Fixed %model placeholder not being replaced in preview
3. **Host Auto-fill**: Now always overwrites when switching API schemes
4. **Provider Mode Detection**: Simplified logic, removed unnecessary fallbacks
5. **Model Default Values**: Auto-save prevents "Select Provider and Model first" message

---

## ğŸ“Š Statistics

- **Files Changed**: 33
- **Lines Added**: 6,410
- **Lines Removed**: 2,588
- **Net Change**: +3,822 lines
- **New Files**: 10 (including modular config structure)
- **Deleted Files**: 4 (cleanup of unused files)

---

## ğŸ”„ Breaking Changes

**None** - All changes are backward compatible with existing configurations.

**Migration Notes:**
- Existing chatbots continue to work without changes
- Chat pairs automatically migrated to local storage on first load
- Provider configurations preserved

---

## ğŸ¯ Next Steps / Future Enhancements

**Potential Future Additions:**
- Additional Replicate models (FLUX, Stable Diffusion, etc.)
- More image editing features (inpainting, outpainting)
- Batch image generation
- Image-to-image translation
- Style transfer capabilities

---

## ğŸ“ Commit History

```
84a26c7 Continued: Code cleanup
f84fecd Refactoring: Clean up code, UI fixes, Add Replicate support
b05c47e Fix configs per image models
0c3e01d Add zip by yarn package
51f79cb Refactoring: Update user-config to seperated folder, cleanup image agent related code
7daf87d Migrate Chat Pair to Local Storage (As ChatBot Settings are local)
18bf39d Image Agent Implementation
7696dc2 WIP: Implement Agent Image Generator (Claude and Chutes)
```

---

## ğŸ™ Acknowledgments

This release includes significant architectural improvements and new features that lay the foundation for advanced multi-modal AI interactions in ChatHub.
